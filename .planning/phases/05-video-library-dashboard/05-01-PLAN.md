---
phase: 05-video-library-dashboard
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - components/videos/video-card.tsx
  - components/videos/video-status-badge.tsx
  - components/videos/delete-video-dialog.tsx
  - components/videos/empty-state.tsx
  - components/ui/alert-dialog.tsx
  - lib/actions/video.ts
autonomous: true

must_haves:
  truths:
    - "Video card displays brand name, status, and date"
    - "Delete button triggers confirmation dialog"
    - "Deleting a video removes both database record and storage files"
    - "Empty state shows helpful message with Create Video CTA"
  artifacts:
    - path: "components/videos/video-card.tsx"
      provides: "Video card with thumbnail, status badge, actions"
      min_lines: 50
    - path: "components/videos/delete-video-dialog.tsx"
      provides: "AlertDialog for delete confirmation"
      min_lines: 40
    - path: "components/videos/empty-state.tsx"
      provides: "Empty state with CTA"
      min_lines: 20
    - path: "lib/actions/video.ts"
      provides: "deleteVideo Server Action"
      contains: "deleteVideo"
  key_links:
    - from: "components/videos/delete-video-dialog.tsx"
      to: "lib/actions/video.ts"
      via: "Server Action call"
      pattern: "deleteVideo"
    - from: "lib/actions/video.ts"
      to: "supabase.storage"
      via: "Storage cleanup on delete"
      pattern: "storage\\.from\\('logos'\\)\\.remove"
---

<objective>
Create reusable video components and delete functionality for the video library.

Purpose: Build the foundational components (VideoCard, status badge, delete dialog, empty state) and Server Action needed for displaying and managing videos. These components will be used by both the dashboard and the dedicated videos page.

Output: Video card component, delete Server Action with storage cleanup, confirmation dialog, empty state component.
</objective>

<execution_context>
@/Users/chakaitos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chakaitos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-video-library-dashboard/05-CONTEXT.md
@.planning/phases/05-video-library-dashboard/05-RESEARCH.md
@lib/actions/video.ts
@app/(protected)/dashboard/page.tsx
@components/ui/card.tsx
@components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install use-debounce and add AlertDialog component</name>
  <files>package.json, components/ui/alert-dialog.tsx</files>
  <action>
1. Install use-debounce library:
   ```bash
   npm install use-debounce
   ```

2. Add shadcn AlertDialog component:
   ```bash
   npx shadcn@latest add alert-dialog
   ```

This provides the AlertDialog for delete confirmation (not Dialog - AlertDialog forces explicit choice for destructive actions per research findings).
  </action>
  <verify>
- `npm ls use-debounce` shows installed version
- `components/ui/alert-dialog.tsx` exists
- `npm run build` passes
  </verify>
  <done>use-debounce installed, AlertDialog component added to project</done>
</task>

<task type="auto">
  <name>Task 2: Create video components (VideoCard, StatusBadge, EmptyState)</name>
  <files>
    components/videos/video-card.tsx
    components/videos/video-status-badge.tsx
    components/videos/empty-state.tsx
  </files>
  <action>
Create `components/videos/` directory and three components:

**1. video-status-badge.tsx:**
Status badge component with visual styling per status:
- `completed`: Green checkmark icon, "Ready" label, default badge variant
- `processing`: Spinning loader icon, "Processing" label, secondary variant
- `pending`: Loader icon (not spinning), "Queued" label, secondary variant
- `failed`: Red X icon, "Failed" label, destructive variant

Use lucide-react icons: CheckCircle, Loader2, XCircle.
Use Badge component from `@/components/ui/badge`.

**2. video-card.tsx:**
Card component for displaying video in grid:
- Aspect-video thumbnail container (16:9 ratio)
- If `thumbnail_url` exists: show image
- If no thumbnail: show centered status icon on muted background
- Status badge positioned top-right of thumbnail
- CardContent: brand_name (truncate long names), created_at date (use toLocaleDateString)
- If status is 'failed' and error_message exists: show error text in destructive color
- CardFooter with actions:
  - Download button (only when status === 'completed' && video_url exists)
    - Use `<a href={video_url} download>` with Button asChild pattern
    - Download icon from lucide-react
  - Delete button (always shown)
    - Use DeleteVideoDialog component (will be created next)
    - Trash2 icon from lucide-react

Video type interface (match database schema):
```typescript
type Video = {
  id: string
  brand_name: string
  status: 'pending' | 'processing' | 'completed' | 'failed'
  video_url: string | null
  thumbnail_url: string | null
  created_at: string
  error_message: string | null
}
```

**3. empty-state.tsx:**
Empty state shown when no videos exist:
- Card with centered content (py-12)
- Video icon (lucide-react) with opacity-50
- "No videos yet" heading
- "Create your first logo animation to get started." description
- Button linking to /create-video with Plus icon

Follow existing codebase patterns for imports and styling.
  </action>
  <verify>
- Files exist in `components/videos/` directory
- `npm run build` passes (TypeScript compiles)
- Components export correctly
  </verify>
  <done>VideoCard, VideoStatusBadge, and EmptyVideosState components created with proper styling and types</done>
</task>

<task type="auto">
  <name>Task 3: Create delete video Server Action and DeleteVideoDialog</name>
  <files>
    lib/actions/video.ts
    components/videos/delete-video-dialog.tsx
  </files>
  <action>
**1. Add deleteVideo function to lib/actions/video.ts:**

Add new Server Action to existing file:

```typescript
export async function deleteVideo(videoId: string): Promise<{ success?: boolean; error?: string }> {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  if (!user) {
    return { error: 'Unauthorized' }
  }

  // 1. Get video to verify ownership and get file URLs
  const { data: video, error: fetchError } = await supabase
    .from('videos')
    .select('logo_url, video_url, thumbnail_url, user_id')
    .eq('id', videoId)
    .single()

  if (fetchError || !video) {
    return { error: 'Video not found' }
  }

  // 2. Verify ownership (extra security check beyond RLS)
  if (video.user_id !== user.id) {
    return { error: 'Unauthorized' }
  }

  // 3. Extract storage paths from URLs and delete files
  // Path format: {user_id}/{uuid}.{ext} stored in 'logos' bucket
  const extractPath = (url: string | null): string | null => {
    if (!url) return null
    try {
      const urlObj = new URL(url)
      // URL pattern: .../storage/v1/object/public/logos/{user_id}/{filename}
      const match = urlObj.pathname.match(/\/logos\/(.+)$/)
      return match ? match[1] : null
    } catch {
      return null
    }
  }

  const filesToDelete = [
    extractPath(video.logo_url),
    extractPath(video.video_url),
    extractPath(video.thumbnail_url),
  ].filter((path): path is string => path !== null)

  // Delete storage files (don't fail if files already deleted)
  if (filesToDelete.length > 0) {
    await supabase.storage.from('logos').remove(filesToDelete)
  }

  // 4. Delete database record (RLS ensures user can only delete own videos)
  const { error: deleteError } = await supabase
    .from('videos')
    .delete()
    .eq('id', videoId)

  if (deleteError) {
    console.error('Delete video error:', deleteError)
    return { error: 'Failed to delete video' }
  }

  // 5. Revalidate pages
  revalidatePath('/videos')
  revalidatePath('/dashboard')

  return { success: true }
}
```

Add import at top: `import { revalidatePath } from 'next/cache'`

**2. Create components/videos/delete-video-dialog.tsx:**

Client component with AlertDialog for delete confirmation:
- Props: `videoId: string`, `brandName: string`
- State: `isDeleting: boolean` for loading state
- On confirm: call deleteVideo Server Action
- Show success toast on delete, error toast on failure
- Use router.refresh() after successful delete to update server component data

Use AlertDialogAction with destructive styling:
`className="bg-destructive text-destructive-foreground hover:bg-destructive/90"`

Disable Cancel and Delete buttons while isDeleting is true.
Button text changes from "Delete Video" to "Deleting..." while processing.
  </action>
  <verify>
- `deleteVideo` function exported from `lib/actions/video.ts`
- `DeleteVideoDialog` component exports correctly
- `npm run build` passes
  </verify>
  <done>deleteVideo Server Action handles storage cleanup and database deletion; DeleteVideoDialog provides confirmation with loading state</done>
</task>

</tasks>

<verification>
All checks must pass:
1. `npm run build` completes without errors
2. All component files exist:
   - `components/videos/video-card.tsx`
   - `components/videos/video-status-badge.tsx`
   - `components/videos/delete-video-dialog.tsx`
   - `components/videos/empty-state.tsx`
   - `components/ui/alert-dialog.tsx`
3. `lib/actions/video.ts` exports both `createVideo` and `deleteVideo`
4. `npm ls use-debounce` shows installed
</verification>

<success_criteria>
- VideoCard component renders brand name, status badge, date, and action buttons
- VideoStatusBadge shows correct styling for each status (completed/processing/pending/failed)
- DeleteVideoDialog shows AlertDialog confirmation before delete
- deleteVideo Server Action removes storage files and database record
- EmptyVideosState shows CTA to create first video
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-video-library-dashboard/05-01-SUMMARY.md`
</output>
