---
phase: 05-video-library-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - components/videos/video-filters.tsx
  - components/videos/video-grid.tsx
  - components/videos/video-card-skeleton.tsx
  - app/(protected)/videos/page.tsx
  - app/(protected)/videos/loading.tsx
autonomous: true

must_haves:
  truths:
    - "User can view list of all their videos"
    - "User can filter videos by status"
    - "User can search videos by brand name"
    - "Videos display with status indicators"
    - "Loading state shows skeleton cards"
  artifacts:
    - path: "app/(protected)/videos/page.tsx"
      provides: "Videos library page with Server Component filtering"
      min_lines: 60
    - path: "components/videos/video-filters.tsx"
      provides: "Search input and status filter dropdown"
      min_lines: 40
    - path: "components/videos/video-grid.tsx"
      provides: "Grid layout for video cards"
      min_lines: 15
  key_links:
    - from: "app/(protected)/videos/page.tsx"
      to: "supabase.from('videos')"
      via: "Server Component data fetch"
      pattern: "\\.from\\('videos'\\)"
    - from: "components/videos/video-filters.tsx"
      to: "URL search params"
      via: "useSearchParams + replace"
      pattern: "useSearchParams|replace\\("
    - from: "app/(protected)/videos/page.tsx"
      to: "components/videos/video-grid.tsx"
      via: "VideoGrid import"
      pattern: "VideoGrid"
---

<objective>
Create the videos library page with search, filter, and grid display.

Purpose: Build the dedicated /videos page where users can view, search, and filter all their videos. Uses Server Components with URL search params for SSR-friendly filtering that's bookmarkable and shareable.

Output: Videos page with filters, grid layout, loading skeleton, and proper Suspense boundaries.
</objective>

<execution_context>
@/Users/chakaitos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chakaitos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-video-library-dashboard/05-CONTEXT.md
@.planning/phases/05-video-library-dashboard/05-RESEARCH.md
@.planning/phases/05-video-library-dashboard/05-01-SUMMARY.md
@app/(protected)/dashboard/page.tsx
@lib/supabase/server.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoFilters client component with debounced search</name>
  <files>components/videos/video-filters.tsx</files>
  <action>
Create client component for search and status filtering:

```typescript
'use client'

import { useSearchParams, usePathname, useRouter } from 'next/navigation'
import { useDebouncedCallback } from 'use-debounce'
import { Input } from '@/components/ui/input'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Search } from 'lucide-react'
```

**Implementation:**

1. **Search input with debounce:**
   - Use `useDebouncedCallback` with 300ms delay
   - On change, update URL `query` param
   - If empty, delete the `query` param
   - Use `defaultValue` from searchParams (not controlled input)
   - Add Search icon inside input (or as prefix)
   - Placeholder: "Search by brand name..."
   - max-w-sm for reasonable width

2. **Status select dropdown:**
   - Options: All Videos (value: "all"), Completed, Processing, Failed
   - On change, update URL `status` param
   - If "all", delete the `status` param
   - Use `defaultValue` from searchParams (defaults to "all")
   - Width: w-[180px]

3. **URL param update pattern:**
```typescript
const handleSearch = useDebouncedCallback((term: string) => {
  const params = new URLSearchParams(searchParams.toString())
  if (term) {
    params.set('query', term)
  } else {
    params.delete('query')
  }
  replace(`${pathname}?${params.toString()}`)
}, 300)

const handleStatusFilter = (status: string) => {
  const params = new URLSearchParams(searchParams.toString())
  if (status === 'all') {
    params.delete('status')
  } else {
    params.set('status', status)
  }
  replace(`${pathname}?${params.toString()}`)
}
```

4. **Layout:** Flex row with gap-4, mb-6 for spacing below filters.
  </action>
  <verify>
- File exists at `components/videos/video-filters.tsx`
- Exports VideoFilters component
- `npm run build` passes
  </verify>
  <done>VideoFilters component updates URL search params with debounced search and instant status filter</done>
</task>

<task type="auto">
  <name>Task 2: Create VideoGrid and VideoCardSkeleton components</name>
  <files>
    components/videos/video-grid.tsx
    components/videos/video-card-skeleton.tsx
  </files>
  <action>
**1. Create components/videos/video-grid.tsx:**

Simple grid layout component that maps over videos:

```typescript
import { VideoCard } from './video-card'

type Video = {
  id: string
  brand_name: string
  status: 'pending' | 'processing' | 'completed' | 'failed'
  video_url: string | null
  thumbnail_url: string | null
  created_at: string
  error_message: string | null
}

export function VideoGrid({ videos }: { videos: Video[] }) {
  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      {videos.map((video) => (
        <VideoCard key={video.id} video={video} />
      ))}
    </div>
  )
}
```

Grid layout: 1 column mobile, 2 columns md, 3 columns lg (per CONTEXT.md decision).

**2. Create components/videos/video-card-skeleton.tsx:**

Skeleton loading state matching VideoCard structure:

```typescript
import { Card, CardContent, CardFooter, CardHeader } from '@/components/ui/card'
import { Skeleton } from '@/components/ui/skeleton'
```

If Skeleton component doesn't exist, add it:
```bash
npx shadcn@latest add skeleton
```

Structure:
- Card with overflow-hidden
- CardHeader p-0 with aspect-video Skeleton (thumbnail placeholder)
- CardContent p-4:
  - Skeleton h-5 w-2/3 (brand name)
  - Skeleton h-4 w-1/3 mt-2 (date)
- CardFooter p-4 pt-0:
  - Skeleton h-9 w-full (button placeholder)

Export both VideoCardSkeleton and VideoGridSkeleton (renders 6 skeleton cards in grid).
  </action>
  <verify>
- Both files exist in `components/videos/`
- Skeleton component available (added if missing)
- `npm run build` passes
  </verify>
  <done>VideoGrid renders video cards in responsive grid; VideoCardSkeleton provides loading state</done>
</task>

<task type="auto">
  <name>Task 3: Create videos library page with Server Component filtering</name>
  <files>
    app/(protected)/videos/page.tsx
    app/(protected)/videos/loading.tsx
  </files>
  <action>
**1. Create app/(protected)/videos/page.tsx:**

Server Component page with URL search params filtering:

```typescript
import { Suspense } from 'react'
import { redirect } from 'next/navigation'
import Link from 'next/link'
import Image from 'next/image'
import { createClient } from '@/lib/supabase/server'
import { UserMenu } from '@/components/navigation/user-menu'
import { VideoGrid } from '@/components/videos/video-grid'
import { VideoFilters } from '@/components/videos/video-filters'
import { VideoGridSkeleton } from '@/components/videos/video-card-skeleton'
import { EmptyVideosState } from '@/components/videos/empty-state'
import { Button } from '@/components/ui/button'
import { Plus } from 'lucide-react'
```

**Page structure:**

1. Auth check (redirect to /login if not authenticated)

2. Header (same pattern as dashboard):
   - Logo linking to /dashboard
   - UserMenu

3. Main content:
   - Page title "Video Library" with "Create Video" button (flex justify-between)
   - VideoFilters component
   - Suspense boundary with VideoGridSkeleton fallback
   - VideoList async component inside Suspense

4. **CRITICAL: Suspense key prop:**
   Use `key={query + status}` on Suspense to force re-render on param changes.
   This prevents the "stuck UI" issue documented in research pitfalls.

**VideoList async component (nested in same file):**

```typescript
type SearchParams = Promise<{
  query?: string
  status?: string
}>

async function VideoList({
  query,
  status,
  userId,
}: {
  query: string
  status: string
  userId: string
}) {
  const supabase = await createClient()

  // Build query with filters
  let queryBuilder = supabase
    .from('videos')
    .select('id, brand_name, status, video_url, thumbnail_url, created_at, error_message')
    .eq('user_id', userId)
    .order('created_at', { ascending: false })

  // Apply status filter (uses composite index: user_id, status)
  if (status !== 'all' && status) {
    queryBuilder = queryBuilder.eq('status', status)
  }

  // Apply search filter (case-insensitive partial match)
  if (query) {
    queryBuilder = queryBuilder.ilike('brand_name', `%${query}%`)
  }

  const { data: videos } = await queryBuilder

  if (!videos?.length) {
    return <EmptyVideosState />
  }

  return <VideoGrid videos={videos} />
}
```

**2. Create app/(protected)/videos/loading.tsx:**

Route-level loading state (shows during navigation):

```typescript
import { VideoGridSkeleton } from '@/components/videos/video-card-skeleton'

export default function Loading() {
  return (
    <div className="min-h-screen bg-background">
      {/* Simplified header skeleton */}
      <header className="border-b">
        <div className="container mx-auto px-4 py-4 h-[56px]" />
      </header>

      <main className="container mx-auto px-4 py-8">
        {/* Title skeleton */}
        <div className="flex items-center justify-between mb-6">
          <div className="h-8 w-40 bg-muted rounded" />
          <div className="h-10 w-32 bg-muted rounded" />
        </div>

        {/* Filters skeleton */}
        <div className="flex gap-4 mb-6">
          <div className="h-10 w-[300px] bg-muted rounded" />
          <div className="h-10 w-[180px] bg-muted rounded" />
        </div>

        <VideoGridSkeleton />
      </main>
    </div>
  )
}
```
  </action>
  <verify>
- `app/(protected)/videos/page.tsx` exists
- `app/(protected)/videos/loading.tsx` exists
- Visit `/videos` shows page (after starting dev server)
- `npm run build` passes
  </verify>
  <done>Videos page fetches and displays user's videos with working search and status filters</done>
</task>

</tasks>

<verification>
All checks must pass:
1. `npm run build` completes without errors
2. All files exist:
   - `components/videos/video-filters.tsx`
   - `components/videos/video-grid.tsx`
   - `components/videos/video-card-skeleton.tsx`
   - `app/(protected)/videos/page.tsx`
   - `app/(protected)/videos/loading.tsx`
3. Skeleton component available in `components/ui/skeleton.tsx`
</verification>

<success_criteria>
- /videos page renders with header, filters, and video grid (or empty state)
- Search input debounces and updates URL query param
- Status dropdown updates URL status param
- Filters are applied server-side via Supabase query
- Loading state shows skeleton grid during navigation
- Empty state shown when no videos match filters
- Suspense boundary re-triggers on filter change (key prop)
</success_criteria>

<output>
After completion, create `.planning/phases/05-video-library-dashboard/05-02-SUMMARY.md`
</output>
