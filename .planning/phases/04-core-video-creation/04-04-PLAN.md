---
phase: 04-core-video-creation
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified:
  - app/create-video/page.tsx
  - app/create-video/_components/UploadStep.tsx
  - app/create-video/_components/DetailsStep.tsx
  - app/create-video/_components/StyleStep.tsx
  - app/create-video/_components/ReviewStep.tsx
  - app/create-video/_components/CreateVideoForm.tsx
  - app/create-video/_components/StepIndicator.tsx
autonomous: true

must_haves:
  truths:
    - "User can upload logo via drag-and-drop or click"
    - "Colors are extracted immediately on upload"
    - "User can enter brand name (required)"
    - "User can select duration from 4s/6s/8s/15s dropdown"
    - "User can select quality from standard/premium/1080p/4k dropdown"
    - "User can select style preset from dropdown"
    - "User can add custom creative direction when style is 'custom'"
    - "User can review all selections before submitting"
    - "Form shows loading state during submission"
    - "Form redirects to dashboard on success"
    - "Form shows error messages on failure"
  artifacts:
    - path: "app/create-video/page.tsx"
      provides: "Main video creation page"
      min_lines: 20
    - path: "app/create-video/_components/CreateVideoForm.tsx"
      provides: "Multi-step form container with state management"
      exports: ["CreateVideoForm"]
    - path: "app/create-video/_components/UploadStep.tsx"
      provides: "Logo upload with drag-and-drop and color extraction"
      exports: ["UploadStep"]
    - path: "app/create-video/_components/DetailsStep.tsx"
      provides: "Brand name, duration, quality inputs"
      exports: ["DetailsStep"]
    - path: "app/create-video/_components/StyleStep.tsx"
      provides: "Style preset and creative direction inputs"
      exports: ["StyleStep"]
    - path: "app/create-video/_components/ReviewStep.tsx"
      provides: "Summary display and submit button"
      exports: ["ReviewStep"]
  key_links:
    - from: "app/create-video/_components/UploadStep.tsx"
      to: "lib/utils/color-extraction.ts"
      via: "import { extractColors }"
      pattern: "extractColors"
    - from: "app/create-video/_components/CreateVideoForm.tsx"
      to: "lib/actions/video.ts"
      via: "import { createVideo }"
      pattern: "createVideo"
    - from: "app/create-video/_components/CreateVideoForm.tsx"
      to: "lib/validations/video-schema.ts"
      via: "import { videoSchema, videoFormDefaults }"
      pattern: "videoSchema"
---

<objective>
Create the multi-step video creation form with all UI components.

Purpose: Enable users to upload logo, enter parameters, and submit video creation requests through an intuitive wizard interface.
Output: Complete /create-video page with UploadStep, DetailsStep, StyleStep, and ReviewStep components.
</objective>

<execution_context>
@/Users/chakaitos/.claude/get-shit-done/workflows/execute-plan.md
@/Users/chakaitos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-core-video-creation/04-CONTEXT.md
@.planning/phases/04-core-video-creation/04-RESEARCH.md
@lib/validations/video-schema.ts
@lib/utils/color-extraction.ts
@lib/actions/video.ts
@components/ui/ (shadcn components available)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add required shadcn components</name>
  <files>components/ui/</files>
  <action>
Install the shadcn components needed for the form if not already present:

```bash
npx shadcn@latest add form input select textarea progress
```

Check which are already installed:
- form (likely exists from auth)
- input (likely exists)
- select (likely exists from billing)
- textarea (may need to add)
- progress (for step indicator)

Only add components that don't exist.
  </action>
  <verify>
  - components/ui/form.tsx exists
  - components/ui/input.tsx exists
  - components/ui/select.tsx exists
  - components/ui/textarea.tsx exists
  - components/ui/progress.tsx exists (or alternative step indicator)
  </verify>
  <done>All required shadcn components are available.</done>
</task>

<task type="auto">
  <name>Task 2: Create step indicator and form container</name>
  <files>app/create-video/_components/StepIndicator.tsx, app/create-video/_components/CreateVideoForm.tsx</files>
  <action>
1. Create app/create-video/_components/StepIndicator.tsx:

```typescript
'use client'

import { cn } from '@/lib/utils'

interface Step {
  number: number
  label: string
}

const STEPS: Step[] = [
  { number: 1, label: 'Upload Logo' },
  { number: 2, label: 'Details' },
  { number: 3, label: 'Style' },
  { number: 4, label: 'Review' },
]

interface StepIndicatorProps {
  currentStep: number
}

export function StepIndicator({ currentStep }: StepIndicatorProps) {
  return (
    <nav aria-label="Progress" className="mb-8">
      <ol className="flex items-center justify-between">
        {STEPS.map((step, index) => (
          <li key={step.number} className="relative flex-1">
            <div className="flex items-center">
              {/* Connector line */}
              {index > 0 && (
                <div
                  className={cn(
                    'absolute left-0 right-1/2 top-4 h-0.5 -translate-y-1/2',
                    step.number <= currentStep ? 'bg-primary' : 'bg-muted'
                  )}
                />
              )}
              {index < STEPS.length - 1 && (
                <div
                  className={cn(
                    'absolute left-1/2 right-0 top-4 h-0.5 -translate-y-1/2',
                    step.number < currentStep ? 'bg-primary' : 'bg-muted'
                  )}
                />
              )}

              {/* Step circle */}
              <div className="relative flex flex-col items-center flex-1">
                <div
                  className={cn(
                    'flex h-8 w-8 items-center justify-center rounded-full border-2 text-sm font-semibold',
                    step.number < currentStep
                      ? 'border-primary bg-primary text-primary-foreground'
                      : step.number === currentStep
                      ? 'border-primary bg-background text-primary'
                      : 'border-muted bg-background text-muted-foreground'
                  )}
                >
                  {step.number < currentStep ? (
                    <svg className="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        fillRule="evenodd"
                        d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                        clipRule="evenodd"
                      />
                    </svg>
                  ) : (
                    step.number
                  )}
                </div>
                <span
                  className={cn(
                    'mt-2 text-xs font-medium',
                    step.number <= currentStep ? 'text-primary' : 'text-muted-foreground'
                  )}
                >
                  {step.label}
                </span>
              </div>
            </div>
          </li>
        ))}
      </ol>
    </nav>
  )
}
```

2. Create app/create-video/_components/CreateVideoForm.tsx:

```typescript
'use client'

import { useState, useCallback, useTransition } from 'react'
import { useRouter } from 'next/navigation'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { toast } from 'sonner'

import { videoSchema, videoFormDefaults, type VideoFormValues } from '@/lib/validations/video-schema'
import { createVideo, type CreateVideoResult } from '@/lib/actions/video'
import { Form } from '@/components/ui/form'

import { StepIndicator } from './StepIndicator'
import { UploadStep } from './UploadStep'
import { DetailsStep } from './DetailsStep'
import { StyleStep } from './StyleStep'
import { ReviewStep } from './ReviewStep'

export function CreateVideoForm() {
  const router = useRouter()
  const [isPending, startTransition] = useTransition()

  // Multi-step state
  const [step, setStep] = useState(1)
  const [file, setFile] = useState<File | null>(null)
  const [colors, setColors] = useState<{ primary: string; secondary: string } | null>(null)

  // React Hook Form
  const form = useForm<VideoFormValues>({
    resolver: zodResolver(videoSchema),
    defaultValues: videoFormDefaults,
  })

  // Handle file upload and color extraction
  const handleUploadComplete = useCallback((uploadedFile: File, extractedColors: { primary: string; secondary: string }) => {
    setFile(uploadedFile)
    setColors(extractedColors)
    form.setValue('primaryColor', extractedColors.primary)
    form.setValue('secondaryColor', extractedColors.secondary)
    setStep(2)
  }, [form])

  // Navigation helpers
  const nextStep = useCallback(() => setStep((s) => Math.min(s + 1, 4)), [])
  const prevStep = useCallback(() => setStep((s) => Math.max(s - 1, 1)), [])

  // Form submission
  const handleSubmit = useCallback(async (values: VideoFormValues) => {
    if (!file) {
      toast.error('Please upload a logo first')
      setStep(1)
      return
    }

    startTransition(async () => {
      // Build FormData for Server Action
      const formData = new FormData()
      formData.append('logo', file)
      formData.append('brandName', values.brandName)
      formData.append('duration', values.duration)
      formData.append('quality', values.quality)
      formData.append('style', values.style)
      formData.append('creativeDirection', values.creativeDirection || '')
      formData.append('primaryColor', values.primaryColor)
      formData.append('secondaryColor', values.secondaryColor)

      const result: CreateVideoResult = await createVideo(formData)

      if (result.error) {
        // Handle field-specific errors
        if (result.fieldErrors) {
          Object.entries(result.fieldErrors).forEach(([field, message]) => {
            if (field === 'logo') {
              toast.error(message)
              setStep(1)
            } else {
              form.setError(field as keyof VideoFormValues, { message })
            }
          })
        } else {
          toast.error(result.error)
        }
        return
      }

      if (result.success) {
        toast.success('Video creation started! Check your dashboard for updates.')
        router.push('/dashboard')
      }
    })
  }, [file, form, router])

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-8">
        <StepIndicator currentStep={step} />

        {step === 1 && (
          <UploadStep
            onComplete={handleUploadComplete}
            currentFile={file}
            currentColors={colors}
          />
        )}

        {step === 2 && (
          <DetailsStep
            form={form}
            onNext={nextStep}
            onBack={prevStep}
          />
        )}

        {step === 3 && (
          <StyleStep
            form={form}
            onNext={nextStep}
            onBack={prevStep}
          />
        )}

        {step === 4 && (
          <ReviewStep
            form={form}
            file={file}
            colors={colors}
            onBack={prevStep}
            isSubmitting={isPending}
          />
        )}
      </form>
    </Form>
  )
}
```
  </action>
  <verify>
  - app/create-video/_components/StepIndicator.tsx exists and exports StepIndicator
  - app/create-video/_components/CreateVideoForm.tsx exists and exports CreateVideoForm
  - CreateVideoForm imports from video-schema, video actions, and step components
  - CreateVideoForm uses useTransition for pending state
  </verify>
  <done>Step indicator and form container created with multi-step state management.</done>
</task>

<task type="auto">
  <name>Task 3: Create UploadStep component with drag-and-drop and color extraction</name>
  <files>app/create-video/_components/UploadStep.tsx</files>
  <action>
Create app/create-video/_components/UploadStep.tsx:

```typescript
'use client'

import { useCallback, useState } from 'react'
import { useDropzone } from 'react-dropzone'
import Image from 'next/image'

import { extractColors } from '@/lib/utils/color-extraction'
import { Button } from '@/components/ui/button'
import { cn } from '@/lib/utils'

interface UploadStepProps {
  onComplete: (file: File, colors: { primary: string; secondary: string }) => void
  currentFile: File | null
  currentColors: { primary: string; secondary: string } | null
}

export function UploadStep({ onComplete, currentFile, currentColors }: UploadStepProps) {
  const [file, setFile] = useState<File | null>(currentFile)
  const [preview, setPreview] = useState<string | null>(currentFile ? URL.createObjectURL(currentFile) : null)
  const [colors, setColors] = useState<{ primary: string; secondary: string } | null>(currentColors)
  const [isExtracting, setIsExtracting] = useState(false)
  const [error, setError] = useState<string | null>(null)

  const onDrop = useCallback(async (acceptedFiles: File[]) => {
    const uploadedFile = acceptedFiles[0]
    if (!uploadedFile) return

    setError(null)
    setFile(uploadedFile)

    // Create preview URL
    const objectUrl = URL.createObjectURL(uploadedFile)
    setPreview(objectUrl)

    // Extract colors immediately
    setIsExtracting(true)
    try {
      const extractedColors = await extractColors(uploadedFile)
      setColors(extractedColors)
    } catch (err) {
      console.error('Color extraction failed:', err)
      // Use fallback colors if extraction fails
      setColors({ primary: '#000000', secondary: '#666666' })
    } finally {
      setIsExtracting(false)
    }
  }, [])

  const { getRootProps, getInputProps, isDragActive, fileRejections } = useDropzone({
    accept: {
      'image/jpeg': ['.jpg', '.jpeg'],
      'image/png': ['.png'],
      'image/webp': ['.webp'],
    },
    maxSize: 25 * 1024 * 1024, // 25MB
    multiple: false,
    onDrop,
    onDropRejected: (rejections) => {
      const rejection = rejections[0]
      if (rejection.errors[0]?.code === 'file-too-large') {
        setError('File is too large. Maximum size is 25MB.')
      } else if (rejection.errors[0]?.code === 'file-invalid-type') {
        setError('Invalid file type. Please upload a JPG, PNG, or WebP image.')
      } else {
        setError(rejection.errors[0]?.message || 'Failed to upload file')
      }
    },
  })

  const handleContinue = () => {
    if (file && colors) {
      onComplete(file, colors)
    }
  }

  const handleRemove = () => {
    setFile(null)
    setPreview(null)
    setColors(null)
    setError(null)
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-semibold tracking-tight">Upload Your Logo</h2>
        <p className="text-muted-foreground">
          Upload your logo in JPG, PNG, or WebP format (max 25MB)
        </p>
      </div>

      {/* Dropzone */}
      <div
        {...getRootProps()}
        className={cn(
          'relative border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors',
          isDragActive ? 'border-primary bg-primary/5' : 'border-muted-foreground/25 hover:border-muted-foreground/50',
          error && 'border-destructive'
        )}
      >
        <input {...getInputProps()} />

        {preview ? (
          <div className="space-y-4">
            <div className="relative w-48 h-48 mx-auto">
              <Image
                src={preview}
                alt="Logo preview"
                fill
                className="object-contain rounded"
              />
            </div>
            <div>
              <p className="font-medium">{file?.name}</p>
              <p className="text-sm text-muted-foreground">
                {file && (file.size / 1024 / 1024).toFixed(2)} MB
              </p>
            </div>
          </div>
        ) : (
          <div className="space-y-4">
            <div className="mx-auto w-12 h-12 rounded-full bg-muted flex items-center justify-center">
              <svg
                className="w-6 h-6 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                />
              </svg>
            </div>
            <div>
              <p className="font-medium">
                {isDragActive ? 'Drop your logo here' : 'Drag & drop your logo here'}
              </p>
              <p className="text-sm text-muted-foreground">
                or click to browse files
              </p>
            </div>
          </div>
        )}
      </div>

      {/* Error message */}
      {error && (
        <p className="text-sm text-destructive">{error}</p>
      )}

      {fileRejections.length > 0 && !error && (
        <p className="text-sm text-destructive">
          {fileRejections[0].errors[0]?.message}
        </p>
      )}

      {/* Extracting indicator */}
      {isExtracting && (
        <p className="text-sm text-muted-foreground animate-pulse">
          Extracting colors from your logo...
        </p>
      )}

      {/* Color preview */}
      {colors && !isExtracting && (
        <div className="flex gap-6">
          <div>
            <p className="text-sm font-medium mb-2">Primary Color</p>
            <div className="flex items-center gap-2">
              <div
                className="w-10 h-10 rounded border shadow-sm"
                style={{ backgroundColor: colors.primary }}
              />
              <span className="text-sm font-mono">{colors.primary}</span>
            </div>
          </div>
          <div>
            <p className="text-sm font-medium mb-2">Secondary Color</p>
            <div className="flex items-center gap-2">
              <div
                className="w-10 h-10 rounded border shadow-sm"
                style={{ backgroundColor: colors.secondary }}
              />
              <span className="text-sm font-mono">{colors.secondary}</span>
            </div>
          </div>
        </div>
      )}

      {/* Action buttons */}
      <div className="flex gap-4">
        {file && (
          <Button type="button" variant="outline" onClick={handleRemove}>
            Remove
          </Button>
        )}
        <Button
          type="button"
          onClick={handleContinue}
          disabled={!file || !colors || isExtracting}
          className="ml-auto"
        >
          {isExtracting ? 'Extracting...' : 'Continue'}
        </Button>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
  - File exports UploadStep component
  - Uses react-dropzone for drag-and-drop
  - Calls extractColors on file upload
  - Shows color swatches after extraction
  - Has Continue button that passes file and colors to parent
  </verify>
  <done>UploadStep component created with drag-and-drop and immediate color extraction.</done>
</task>

<task type="auto">
  <name>Task 4: Create DetailsStep and StyleStep components</name>
  <files>app/create-video/_components/DetailsStep.tsx, app/create-video/_components/StyleStep.tsx</files>
  <action>
1. Create app/create-video/_components/DetailsStep.tsx:

```typescript
'use client'

import { UseFormReturn } from 'react-hook-form'

import { VideoFormValues, VIDEO_DURATIONS, VIDEO_QUALITIES } from '@/lib/validations/video-schema'
import { Button } from '@/components/ui/button'
import {
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormMessage,
  FormDescription,
} from '@/components/ui/form'
import { Input } from '@/components/ui/input'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'

interface DetailsStepProps {
  form: UseFormReturn<VideoFormValues>
  onNext: () => void
  onBack: () => void
}

const DURATION_LABELS: Record<string, string> = {
  '4s': '4 seconds - Quick intro',
  '6s': '6 seconds - Standard',
  '8s': '8 seconds - Extended',
  '15s': '15 seconds - Full animation',
}

const QUALITY_LABELS: Record<string, string> = {
  'standard': 'Standard (720p)',
  'premium': 'Premium (1080p)',
  '1080p': '1080p HD',
  '4k': '4K Ultra HD',
}

export function DetailsStep({ form, onNext, onBack }: DetailsStepProps) {
  const handleNext = async () => {
    // Validate fields for this step
    const isValid = await form.trigger(['brandName', 'duration', 'quality'])
    if (isValid) {
      onNext()
    }
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-semibold tracking-tight">Video Details</h2>
        <p className="text-muted-foreground">
          Enter your brand name and select video specifications
        </p>
      </div>

      <div className="space-y-6">
        {/* Brand Name */}
        <FormField
          control={form.control}
          name="brandName"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Brand Name</FormLabel>
              <FormControl>
                <Input
                  {...field}
                  placeholder="Enter your brand name"
                  maxLength={100}
                />
              </FormControl>
              <FormDescription>
                This will appear in your logo animation
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* Duration */}
        <FormField
          control={form.control}
          name="duration"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Duration</FormLabel>
              <Select onValueChange={field.onChange} defaultValue={field.value}>
                <FormControl>
                  <SelectTrigger>
                    <SelectValue placeholder="Select duration" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  {VIDEO_DURATIONS.map((duration) => (
                    <SelectItem key={duration} value={duration}>
                      {DURATION_LABELS[duration]}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
              <FormDescription>
                Longer videos have more elaborate animations
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* Quality */}
        <FormField
          control={form.control}
          name="quality"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Quality</FormLabel>
              <Select onValueChange={field.onChange} defaultValue={field.value}>
                <FormControl>
                  <SelectTrigger>
                    <SelectValue placeholder="Select quality" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  {VIDEO_QUALITIES.map((quality) => (
                    <SelectItem key={quality} value={quality}>
                      {QUALITY_LABELS[quality]}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
              <FormDescription>
                Higher quality videos are recommended for marketing
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />
      </div>

      {/* Navigation */}
      <div className="flex gap-4">
        <Button type="button" variant="outline" onClick={onBack}>
          Back
        </Button>
        <Button type="button" onClick={handleNext} className="ml-auto">
          Continue
        </Button>
      </div>
    </div>
  )
}
```

2. Create app/create-video/_components/StyleStep.tsx:

```typescript
'use client'

import { UseFormReturn } from 'react-hook-form'

import { VideoFormValues, STYLE_PRESETS } from '@/lib/validations/video-schema'
import { Button } from '@/components/ui/button'
import {
  FormField,
  FormItem,
  FormLabel,
  FormControl,
  FormMessage,
  FormDescription,
} from '@/components/ui/form'
import { Textarea } from '@/components/ui/textarea'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'

interface StyleStepProps {
  form: UseFormReturn<VideoFormValues>
  onNext: () => void
  onBack: () => void
}

const STYLE_DESCRIPTIONS: Record<string, string> = {
  'modern': 'Clean lines, smooth transitions, contemporary feel',
  'minimal': 'Subtle animations, focus on simplicity',
  'bold': 'Strong movements, high impact, attention-grabbing',
  'elegant': 'Refined animations, sophisticated aesthetics',
  'playful': 'Fun, bouncy movements, energetic vibe',
  'corporate': 'Professional, polished, business-appropriate',
  'cinematic': 'Dramatic, movie-quality effects',
  'custom': 'Describe your own creative direction',
}

export function StyleStep({ form, onNext, onBack }: StyleStepProps) {
  const selectedStyle = form.watch('style')

  const handleNext = async () => {
    // Validate fields for this step
    const isValid = await form.trigger(['style', 'creativeDirection'])
    if (isValid) {
      onNext()
    }
  }

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-semibold tracking-tight">Animation Style</h2>
        <p className="text-muted-foreground">
          Choose a style preset or describe your own creative direction
        </p>
      </div>

      <div className="space-y-6">
        {/* Style Preset */}
        <FormField
          control={form.control}
          name="style"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Style Preset</FormLabel>
              <Select onValueChange={field.onChange} defaultValue={field.value}>
                <FormControl>
                  <SelectTrigger>
                    <SelectValue placeholder="Select a style" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  {STYLE_PRESETS.map((style) => (
                    <SelectItem key={style} value={style}>
                      <span className="capitalize">{style}</span>
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
              {selectedStyle && (
                <FormDescription>
                  {STYLE_DESCRIPTIONS[selectedStyle]}
                </FormDescription>
              )}
              <FormMessage />
            </FormItem>
          )}
        />

        {/* Creative Direction (shown when 'custom' selected, or as optional for others) */}
        <FormField
          control={form.control}
          name="creativeDirection"
          render={({ field }) => (
            <FormItem>
              <FormLabel>
                Creative Direction
                {selectedStyle !== 'custom' && (
                  <span className="text-muted-foreground font-normal ml-1">(optional)</span>
                )}
              </FormLabel>
              <FormControl>
                <Textarea
                  {...field}
                  placeholder={
                    selectedStyle === 'custom'
                      ? 'Describe the animation style you want...'
                      : 'Add any specific instructions or preferences...'
                  }
                  className="min-h-[100px]"
                  maxLength={500}
                />
              </FormControl>
              <FormDescription>
                {selectedStyle === 'custom'
                  ? 'Be specific about the movements, effects, and overall feel you want'
                  : 'You can add extra instructions to customize the selected style'}
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />
      </div>

      {/* Navigation */}
      <div className="flex gap-4">
        <Button type="button" variant="outline" onClick={onBack}>
          Back
        </Button>
        <Button type="button" onClick={handleNext} className="ml-auto">
          Continue
        </Button>
      </div>
    </div>
  )
}
```
  </action>
  <verify>
  - DetailsStep.tsx exports DetailsStep component
  - DetailsStep has brandName input, duration select, quality select
  - StyleStep.tsx exports StyleStep component
  - StyleStep has style preset select and creative direction textarea
  - Both components have Back and Continue buttons
  - Both components validate their fields before proceeding
  </verify>
  <done>DetailsStep and StyleStep components created with form fields and validation.</done>
</task>

<task type="auto">
  <name>Task 5: Create ReviewStep and main page</name>
  <files>app/create-video/_components/ReviewStep.tsx, app/create-video/page.tsx</files>
  <action>
1. Create app/create-video/_components/ReviewStep.tsx:

```typescript
'use client'

import { UseFormReturn } from 'react-hook-form'
import Image from 'next/image'

import { VideoFormValues } from '@/lib/validations/video-schema'
import { Button } from '@/components/ui/button'
import { Card, CardContent } from '@/components/ui/card'

interface ReviewStepProps {
  form: UseFormReturn<VideoFormValues>
  file: File | null
  colors: { primary: string; secondary: string } | null
  onBack: () => void
  isSubmitting: boolean
}

const DURATION_LABELS: Record<string, string> = {
  '4s': '4 seconds',
  '6s': '6 seconds',
  '8s': '8 seconds',
  '15s': '15 seconds',
}

const QUALITY_LABELS: Record<string, string> = {
  'standard': 'Standard (720p)',
  'premium': 'Premium (1080p)',
  '1080p': '1080p HD',
  '4k': '4K Ultra HD',
}

export function ReviewStep({ form, file, colors, onBack, isSubmitting }: ReviewStepProps) {
  const values = form.getValues()
  const preview = file ? URL.createObjectURL(file) : null

  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-2xl font-semibold tracking-tight">Review Your Video</h2>
        <p className="text-muted-foreground">
          Please review your selections before creating the video
        </p>
      </div>

      <Card>
        <CardContent className="pt-6">
          <div className="grid md:grid-cols-2 gap-6">
            {/* Logo Preview */}
            <div>
              <p className="text-sm font-medium text-muted-foreground mb-2">Logo</p>
              {preview && (
                <div className="relative w-32 h-32 rounded border bg-muted">
                  <Image
                    src={preview}
                    alt="Logo preview"
                    fill
                    className="object-contain p-2"
                  />
                </div>
              )}
            </div>

            {/* Colors */}
            <div>
              <p className="text-sm font-medium text-muted-foreground mb-2">Extracted Colors</p>
              <div className="flex gap-4">
                {colors && (
                  <>
                    <div className="flex items-center gap-2">
                      <div
                        className="w-8 h-8 rounded border"
                        style={{ backgroundColor: colors.primary }}
                      />
                      <span className="text-sm font-mono">{colors.primary}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div
                        className="w-8 h-8 rounded border"
                        style={{ backgroundColor: colors.secondary }}
                      />
                      <span className="text-sm font-mono">{colors.secondary}</span>
                    </div>
                  </>
                )}
              </div>
            </div>

            {/* Brand Name */}
            <div>
              <p className="text-sm font-medium text-muted-foreground mb-1">Brand Name</p>
              <p className="font-medium">{values.brandName}</p>
            </div>

            {/* Duration */}
            <div>
              <p className="text-sm font-medium text-muted-foreground mb-1">Duration</p>
              <p className="font-medium">{DURATION_LABELS[values.duration]}</p>
            </div>

            {/* Quality */}
            <div>
              <p className="text-sm font-medium text-muted-foreground mb-1">Quality</p>
              <p className="font-medium">{QUALITY_LABELS[values.quality]}</p>
            </div>

            {/* Style */}
            <div>
              <p className="text-sm font-medium text-muted-foreground mb-1">Style</p>
              <p className="font-medium capitalize">{values.style}</p>
            </div>

            {/* Creative Direction */}
            {values.creativeDirection && (
              <div className="md:col-span-2">
                <p className="text-sm font-medium text-muted-foreground mb-1">Creative Direction</p>
                <p className="text-sm">{values.creativeDirection}</p>
              </div>
            )}
          </div>
        </CardContent>
      </Card>

      {/* Credit Notice */}
      <div className="rounded-lg border bg-muted/50 p-4">
        <p className="text-sm">
          <span className="font-medium">Credit Cost:</span> 1 credit will be deducted from your balance when you create this video.
        </p>
      </div>

      {/* Navigation */}
      <div className="flex gap-4">
        <Button type="button" variant="outline" onClick={onBack} disabled={isSubmitting}>
          Back
        </Button>
        <Button type="submit" className="ml-auto" disabled={isSubmitting}>
          {isSubmitting ? 'Creating Video...' : 'Create Video'}
        </Button>
      </div>
    </div>
  )
}
```

2. Create app/create-video/page.tsx:

```typescript
import { Metadata } from 'next'
import { redirect } from 'next/navigation'
import Link from 'next/link'
import Image from 'next/image'

import { createClient } from '@/lib/supabase/server'
import { getCreditBalance } from '@/lib/actions/billing'
import { CreateVideoForm } from './_components/CreateVideoForm'
import { Button } from '@/components/ui/button'
import { UserMenu } from '@/components/UserMenu'

export const metadata: Metadata = {
  title: 'Create Video | Animation Labs',
  description: 'Create a professional logo animation video',
}

export default async function CreateVideoPage() {
  const supabase = await createClient()

  // Check authentication
  const { data: { user } } = await supabase.auth.getUser()
  if (!user) {
    redirect('/login?redirect=/create-video')
  }

  // Check credit balance
  const creditResult = await getCreditBalance()
  const credits = creditResult.balance?.total ?? 0

  return (
    <div className="min-h-screen bg-background">
      {/* Header */}
      <header className="border-b">
        <div className="container flex h-16 items-center justify-between">
          <Link href="/dashboard" className="flex items-center gap-2">
            <Image
              src="/logo.svg"
              alt="Animation Labs"
              width={32}
              height={32}
              className="h-8 w-auto"
            />
            <span className="font-semibold">Animation Labs</span>
          </Link>

          <div className="flex items-center gap-4">
            <span className="text-sm text-muted-foreground">
              {credits} credit{credits !== 1 ? 's' : ''} available
            </span>
            <UserMenu />
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="container py-8">
        <div className="mx-auto max-w-2xl">
          {credits === 0 ? (
            // No credits - show upgrade prompt
            <div className="text-center py-12">
              <h1 className="text-2xl font-semibold tracking-tight mb-2">No Credits Available</h1>
              <p className="text-muted-foreground mb-6">
                You need at least 1 credit to create a video. Upgrade your plan or purchase credits to continue.
              </p>
              <div className="flex gap-4 justify-center">
                <Button asChild variant="outline">
                  <Link href="/dashboard">Back to Dashboard</Link>
                </Button>
                <Button asChild>
                  <Link href="/billing">Get More Credits</Link>
                </Button>
              </div>
            </div>
          ) : (
            // Has credits - show form
            <CreateVideoForm />
          )}
        </div>
      </main>
    </div>
  )
}
```
  </action>
  <verify>
  - ReviewStep.tsx exports ReviewStep component
  - ReviewStep shows all form values and file preview
  - ReviewStep has submit button that uses form's onSubmit
  - page.tsx is a Server Component with authentication check
  - page.tsx shows CreateVideoForm or no-credits message
  - page.tsx has header with logo, credit balance, and UserMenu
  </verify>
  <done>ReviewStep component and main page created with authentication, credit check, and full form flow.</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - build succeeds
2. Run `npx tsc --noEmit` - TypeScript compiles
3. Navigate to /create-video when logged in:
   - See step indicator with 4 steps
   - Step 1: Upload area accepts drag-and-drop
   - Colors are extracted after upload
   - Step 2: Brand name, duration, quality fields
   - Step 3: Style preset and creative direction
   - Step 4: Review all selections and submit
4. If no credits, see upgrade prompt instead of form
</verification>

<success_criteria>
- All step components render without errors
- Upload step accepts files via drag-and-drop and click
- Color extraction happens immediately on upload
- Form validates each step before proceeding
- Review step shows all selections
- Submit button triggers Server Action with loading state
- Successful submission redirects to dashboard
- No credits state shows upgrade prompt
</success_criteria>

<output>
After completion, create `.planning/phases/04-core-video-creation/04-04-SUMMARY.md`
</output>
